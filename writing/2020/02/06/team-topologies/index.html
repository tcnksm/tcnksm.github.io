<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Team Topologiesを読んだ | SOTA</title>
    
    <link href="https://fonts.googleapis.com/css?family=Lato%3a900" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link href="https://deeeet.com/index.xml" rel="alternate" type="application/rss+xml" title="" />
    <meta name="title" content="https://deeeet.com/writing/2020/02/06/team-topologies/">
    <link rel="canonical" href="https://deeeet.com/writing/2020/02/06/team-topologies/">
    
    <meta property="og:title" content="Team Topologiesを読んだ"/>
    <meta property="og:url" content="https://deeeet.com/writing/2020/02/06/team-topologies/"/>
  </head>
  
  <body>
    <section class="site-nav">
      <header>
        <nav id="navigation">
          <a class="name" href="/">SOTA</a>
        </nav>        
      </header>
    </section>
    


<article>
  <div class="container">
    <header>
      <div class="meta">
        <time pubdate datetime="2020-02-06" title="2020-02-06">February 06, 2020</time>
      </div>
      <h1 class="title">Team Topologiesを読んだ</h1>
    </header>
    
    <section>
      

<p><a href="https://teamtopologies.com/">https://teamtopologies.com/</a></p>

<p>DevOps consultantとして技術と組織の両面からDevOpsの支援を行なってるMatthew SkeltonとManuel Paisによる本．Consultant本は大体中身が薄く感じることが多くなり手に取ることは少なくなってきたが，各所で見かけたり，2人によるDevOpsにおけるチームのあり方のパターンをまとめた<a href="https://web.devopstopologies.com/">What Team Structure is Right for DevOps to Flourish?</a>が良かったので読んでみた．</p>

<p>本書はDevOpsの視点から高速なDeliveryを実現するためにどのようなチームや組織を作るべきかについてまとめている．個人ではなくチームをDeliveryの最も重要な単位と考え（Team first-thinking），チームが最大限にパフォーマンスを発揮するために，チームの人数やその責任の範囲のデザインの仕方（Team API）から，基本的なチームタイプ（Fundamental team topology）やそのチーム間のコミュニケーションパターン（Team interaction mode）とそれをどのようの変化させていくか（Organizational sensing・Topology evolution）が紹介されている．また理論だけではなくてCase studyとして各社の事例も各章で紹介されている．</p>

<p>本書は大きく3つのPartからなる．Part1ではConwayの法則を再考しつつ現実の組織がいかにアーキテクチャやコミュニケーションパターンが考慮されていないか?という本書で解こうとしている問題がまとめられている．以降のPartはその解法としてPart2は基本的なチームタイプについてPart3はそのチームのコミュニケーションのパターンとそれをいかに進化させていくかについて紹介される．以下ではこれらを簡単にまとめておく．</p>

<h2 id="team-first-thinking">Team-first Thinking</h2>

<p>本書に限らず多くのところで述べられているように「小さく長期的に安定した」なチームを作ることは非常に大切である（例えば <a href="https://increment.com/teams/how-twilio-scaled-its-engineering-structure/">How Twilio scaled its engineering structure</a>や<a href="https://increment.com/teams/how-to-build-a-startup-engineering-team/">How to build a startup engineering team</a>など）</p>

<p>「小さな」は本書では具体的には5-9人である．この人数の根拠として<a href="https://en.m.wikipedia.org/wiki/Dunbar%27s_number">Dunbar&rsquo;s Number</a>を使っている．Dunbar&rsquo;s NumberはDunbarが提唱した人間が安定的な社会関係を維持できるとされる人数の認知的な上限である．簡単に言うと何人までは互いに信頼でき，何人までは覚えていられるか？という人数のラインを示している．これをMicroservicesの組織の形態でよく使われてるSpotifyのチームの形（<a href="https://blog.crisp.se/wp-content/uploads/2012/11/SpotifyScaling.pdf">Scaling Agile @ Spotify</a>）に落とし込むとSquadが8-10人，Tribeが50-150人，Divisionが150-人となりチームの粒度やそのグルーピングの限度の指標に利用できる．またコミュニケーションのリンクの数からも「小さな」が良いことは理解できる（以下はチームの人数とそこでのコミュニケーションのパスの数 ．12人でも既に66もある．<a href="https://blog.nuclino.com/two-pizza-teams-the-science-behind-jeff-bezos-rule">Two-Pizza Teams: The Science Behind Jeff Bezos&rsquo; Rule</a>）</p>

<p><img src="https://blog.nuclino.com/files/227d9349-2588-4845-a420-3f4eb6c61fdc/team-members-links.png" alt="https://blog.nuclino.com/files/227d9349-2588-4845-a420-3f4eb6c61fdc/team-members-links.png" /></p>

<p>「長期的に安定」するべきはのは，チームとは互いに信頼し合い働き方や考え方を一致させて初めて高いパフォーマンスを出せる（<a href="https://en.m.wikipedia.org/wiki/Tuckman%27s_stages_of_group_development">Tuckman&rsquo;s stages of group development</a>）ものであり，それには時間がかかるためである．プロジェクトの度にチームがコロコロ変わっていてはチームとしてのゲル化は進まずパフォーマンスも上がらない．逆に高いパフォーマンスのチームを分けたりするとProductivityは一気に落ちる．</p>

<p>「長期で安定した」チームを持つことで初めてOwnershipについて考えることができるようになる．Ownershipとは「Continuity of care」を持つことであり，チームはそれによって段階的に長期にものを考えることができるようになる．目の前の問題を解決する段階から，数ヶ月先のこと考えて実験を行う段階へ向かうことができるようになる．NetflixがどのようにOwnershipを育てているかについて語っている<a href="https://youtu.be/ddOGmao_cnA">Mistakes and Discoveries While Cultivating Ownership</a>ではOwnershipのLevelを定義しており，目指すべきところ（かつLeadershipがメンバーに持たせるのは）は「Vision」であるとしている．「Vision」はまさに長期で目指すべきところを考えることに他ならない（これをさらに組織全体でTribeレベルでもできてるのがSpotify <a href="https://youtu.be/gTXEXcGvnKk">Breaking Hierarchy - How Spotify Enables Engineer Decision Making</a> ）．長期でVisionを持つことは直前の問題解決の意思決定にも直結する（例えば3ヶ月後にxをする予定だから今はyに時間をかけずに単純なzという手法を使おうと思うことができる）．</p>

<p><img src="https://user-images.githubusercontent.com/1256183/73893817-09957f80-48be-11ea-889b-a160fe8faaf5.png" alt="https://user-images.githubusercontent.com/1256183/73893817-09957f80-48be-11ea-889b-a160fe8faaf5.png" /></p>

<p>以下はStripeの<a href="https://twitter.com/lethain">Will Larson</a>が<a href="https://www.amazon.com/dp/1732265186/">Elegant puzzle</a>で書いているチームの4つ状態である．「長期に安定」チームによりチームはInnovativeな状態を目指すことができる．</p>

<p><img src="https://user-images.githubusercontent.com/1256183/73893894-43ff1c80-48be-11ea-874d-df8618d01e95.jpeg" alt="https://user-images.githubusercontent.com/1256183/73893894-43ff1c80-48be-11ea-874d-df8618d01e95.jpeg" /></p>

<p>さらにそのチームの責任が大きすぎないか，認知負荷が高すぎないか？も意識する必要がある．1つのチームが多くの責任を持ちすぎると認知負荷がチームのキャパシティを超え始める．そうなるとDeliveryのスピードは遅くなり他のチームのボトルネックになりメンバーのモチベーションや技術の熟達（Mastery）にも影響を与え始めてしまう（技術領域のExpertiseが広く浅くなる）．組織は既存のメンバーの認知不可を超えてソフトウェアのサブシステムを増やしてはいけない．</p>

<h2 id="fundamental-team-topologies">Fundamental Team Topologies</h2>

<p>役割の曖昧な複数のタイプのチームがあると全体像が曖昧になりどのチームがどの責任を持っているのかがわかりくくなる．そのため持つべきチームのタイプは制限するべきである．本書が提案する基礎となる4つのチームは以下．</p>

<p><img src="https://user-images.githubusercontent.com/1256183/73894183-0222a600-48bf-11ea-9c74-849f0332dca3.jpeg" alt="https://user-images.githubusercontent.com/1256183/73894183-0222a600-48bf-11ea-9c74-849f0332dca3.jpeg" /></p>

<ul>
<li>Stream aligned team: ビジネスドメインにAlignしその開発フローを回すチーム．例えばサービスやプロダクト，複数機能のセットや1つのUser journeyやUser personaで区切ることができる．ビジネスにとって最も重要なチームであり，それ以外のチームはこのチームの負担を減らすために存在する</li>
<li>Enabling team: 機能開発で時間がないチームに対して新技術やプラクティスの導入を支援していくチーム．メルカリでいうとSolution teamがこれに近いのではないかと思う．永久にそのチームにいるわけではなくて一時的にチームに参加しそのチームが自律して動けるようになることを目標とする．SREもこれに近いと思っている（<a href="https://medium.com/@rakyll/the-sre-model-6e19376ef986">The SRE model</a>）</li>
<li>Complicated sub-system team: 専門知識が必要な複雑なサブシステムを開発運用するチーム．例えば画像処理やリアルタイムシステムなど．Stream alinged teamの認知不可を減らしていくのが目的．</li>
<li>Platform team: Stream aligned teamが自律してSDLCを回せることを補助するためのチーム．メルカリでいうと私が所属するMicroservices Platform teamがこれに当たる（<a href="https://speakerdeck.com/tcnksm/kai-fa-zhe-xiang-kefalseji-pan-wotukuru">開発者向けの基盤をつくる</a>）</li>
</ul>

<p>これだけではなくてPlatform teamに関してはこれはフラクタル的になりPlatform team内に同様のチームを持つようになる．つまりObservabilityやDeliveryに特化したStream aligned teamがあり，それらを動かすためのPlatformのPlatformがあるようになる（まさに同じことをやろうと思っていた）．</p>

<p>そしてこれらのコミュニケーションパターンは以下の3つに分けられる．</p>

<ul>
<li>Collaboration: 他のチームと一緒に働く．</li>
<li>X-as-a-Service: コラボレーションを最小にしてツールやAPIを提供する．例えばStream aligned teamとPlatform teamの関係はこれが理想．</li>
<li>Facilitation: 他のチームの補助する．例えばStream aligned teamとEnabling teamの関係はこれにあたる．</li>
</ul>

<p>どのようにチームがコラボレーションするかはソフトウェアのあり方にも直結する．例えばStream aligned teamとPlatform teamがCollaborationをするとそれが前提のツールやAPIしか作られずStream aligned teamはPlatform teamの補助なしでは動けなくなってしまう．またこれらは静的なものでもない．Stream aligned teamとComplicated sub-system teamはCollaborationをしつつベストなBoundaryを探して最終的にX-as-a-ServiceとなりStream aligned teamはAPIを通してそのsub systemを使うだけになる状態を目指していくのが理想である．チーム間のコミュニケーションのあり方は，理想の状態を定義した上で動的に進化していくべきものである．</p>

<p>どのTopologyを選択するべきかのベストな解はない．メンバーのスキルやLeadership，目指したいアーキテクチャやビジネスゴールを念頭においてTopologyを選択する必要がある．少なくともチームを変えすぎると生産性は崩壊するので頻度は減らしつつ局所最適するのではなく組織全体を見てどうするべきかを考えないといけない．</p>

<h2 id="conslusion">Conslusion</h2>

<p>今の自分にとってとても学びの多い本だった．本書はMicroservicesアーキテクチャが前提ではないが，書かれている内容はMicroservicesアーキテクチャの上で実現するべきチームや組織のあり方であり，現実にすぐにフィードバックできる内容だったと思う．またプロダクトチームについてだけではなく，自分が所属しているPlatform的なチームがどうあるべきかについても書かれており指針となった．そしてConwayはRealでDopeである．</p>

      <div class="social">
  
  
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="deeeet" data-count="none">Tweet</a>
  
  
</div>

    </section>

    <footer>
      <address>
        
        <img src="/images/bio.jpeg"/>
        
        <p>Written by <strong><a rel="author" href="https://twitter.com/deeeet" title="Taichi Nakashima" target="_blank">Taichi Nakashima</a></strong><br>
          <span class="muted">Microservices Platform Team at Mercari, Inc.. Please contact me via twitter.</span>
        </p>
      </address>

    </footer>

  </div>
</article>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<script type="text/javascript">var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45390253-1', 'auto');
  ga('send', 'pageview');

</script>



<script>
  $(document).ready(function() {
  
  $('p:has(img)').css('text-align', 'center');
  $('iframe').css('style', 'display: block; margin: 0px auto;');
  });
</script>

